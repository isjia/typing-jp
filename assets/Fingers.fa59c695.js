var te=Object.defineProperty;var H=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var V=(o,l,c)=>l in o?te(o,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[l]=c,I=(o,l)=>{for(var c in l||(l={}))re.call(l,c)&&V(o,c,l[c]);if(H)for(var c of H(l))ne.call(l,c)&&V(o,c,l[c]);return o};import{r as s,j as t,R as b,e as a,C as u,B as O,v as se,o as oe,P as ce,w as le,x as ie,y as z,z as ue,D as ae}from"./vendor.0ee0e69c.js";import{s as de}from"./index.f7bb3066.js";import{w as B}from"./wordTool.00511603.js";const{Countdown:he}=ae,{Panel:fe}=z,U=o=>{const l=Math.floor(o/60),c=o%60;return`${l}:${c<10?"0":""}${c}`},me=o=>{const[l,c]=s.exports.useState(!0),[q,pe]=s.exports.useState(0),[i,F]=s.exports.useState(0),[C,N]=s.exports.useState([]),[d,A]=s.exports.useState(""),[p,j]=s.exports.useState(!1),y=s.exports.useRef(B.getWords(o.$state.root.wordsMode,o.$state.root.customerWords)),x=s.exports.useRef(null),L=s.exports.useRef(null),f=s.exports.useRef(0),R=s.exports.useRef(!1),M=s.exports.useRef(0),v=s.exports.useRef(0),T=s.exports.useRef(!1),S=s.exports.useRef(53),W=s.exports.useRef(0),w=s.exports.useRef(parseInt(o.$state.root.countdownTime,10)),[G,J]=s.exports.useState(U(w.current)),[D,Q]=s.exports.useState(!0),[k,X]=s.exports.useState(!1),h=s.exports.useRef({wpm:0,correct:0,wrong:0,inputWordArr:[]}),E=e=>{N(n=>{const r=[...y.current];return e?(f.current=0,[I({isCorrect:null},r[f.current])]):(f.current+=1,f.current>=r.length&&(f.current=0),n.concat(I({isCorrect:null},r[f.current])))})},K=(e,n)=>{const r=e.join("");return r===n.text?(console.log("correct text: ",r,", ",n.text),!0):r===n.label?(console.log("correct label: ",r,", ",n.label),!0):!1},Y=e=>{e&&/^\d+$/g.test(String(e))&&(w.current=Number(e),J(U(Number(e))))},Z=()=>{if(T.current){const e=h.current.inputWordArr,n=e.filter(r=>r.isCorrect===!0).length;h.current={wpm:Math.round(n/(w.current/60)),correct:n,wrong:e.filter(r=>r.isCorrect===!1).length,inputWordArr:e},j(!0),console.log(C)}},$=s.exports.useCallback(()=>{R.current=!1,v.current=0,T.current=!1,W.current=0,j(!1),A(""),F(0),y.current=B.shuffle(y.current),E(!0),setTimeout(()=>{L.current.focus(),h.current={wpm:0,correct:0,wrong:0,inputWordArr:[]}},10)},[]),_=e=>{e.shiftKey&&e.keyCode===32&&(console.log("shift + space: ",e.keyCode,k),X(!k)),e.shiftKey&&e.keyCode===13&&(console.log("shift + enter: ",e.keyCode),alert(C[i].trans)),e.ctrlKey&&e.keyCode===13&&$(),!p&&(W.current+=1,console.log("keystrokeCountRef.current: ",W.current))};return s.exports.useEffect(()=>{if(x){const e=x.current.lastElementChild;if(!e||!e.lastElementChild)return;const n=x.current.scrollTop;Array.from(e.children).forEach((r,g)=>{S.current=r.offsetHeight;const m=r.offsetTop-e.offsetTop,P=S.current+n,ee=P-5<m&&m<P+5;!R.current&&ee&&(M.current=g,R.current=!0)}),e.lastElementChild.offsetTop-e.offsetTop-n<S.current*3+1&&E()}},[C.length]),s.exports.useEffect(()=>{if(p)return;if(d===""){N(n=>{const r=[...n];return r[i]&&(r[i].isCorrect=null),r});return}T.current=!0;const e=Array.from(d.trim());if(d[d.length-1]===" "||d[d.length-1]==="\u3000"){if(A(""),e.length===0)return;N(n=>{let r=[...n];const g=r[i],m=K(e,g);return r[i].isCorrect=m,h.current.inputWordArr.push(Object.assign({input:e.join("")},r[i])),r}),F(i+1),i+1===M.current&&(v.current+=1,x.current.scrollTop=S.current*v.current,R.current=!1,E())}else N(n=>{const r=[...n],g=r[i],m=K(e,g);return r[i].isCorrect=m===!1?!1:null,r})},[i,p,d]),s.exports.useEffect(()=>{y.current=B.getWords(o.$state.root.wordsMode,o.$state.root.customerWords),setTimeout(()=>{$(),c(!1)},1e3)},[o.$state.root.wordsMode,o.$state.root.customerWords,$]),t("div",{className:"home",children:t(b,{justify:"center",align:"middle",children:a(u,{flex:"450px",className:`home-scale-box-${o.$state.root.uiScale}`,children:[t("div",{className:"hide-control",children:a(O,{tabIndex:-1,type:"link",onClick:()=>Q(e=>!e),children:[D?"\u663E\u793A":"\u9690\u85CF","\u5047\u540D"]})}),a("div",{className:"home-show-main",children:[p&&t("div",{className:"type-end"}),t(se,{spinning:l,delay:50,wrapperClassName:"loading-wrapper",children:t("div",{className:"home-show-main-window",ref:x,children:t(b,{gutter:12,children:C.map((e,n)=>a(u,{className:`home-show-main-window-item ${e.isCorrect===!0?"correct":""} ${e.isCorrect===!1?"incorrect":""}`,children:[t("div",{className:`home-show-main-window--label ${i===n?"acting":""}`,children:e.label}),t("div",{className:`home-show-main-window--text ${D?"hide":""}
                                                ${i===n&&k?"show-text":""}
                                                `,children:e.text})]},n))})})})]}),a(b,{justify:"space-between",align:"middle",gutter:0,children:[t(u,{flex:"285px",children:t(oe,{className:"home-input",ref:L,value:d,onChange:e=>{A(e.target.value)},onKeyUp:_})}),t(u,{flex:"90px",children:t(ce,{content:a("div",{children:[t(le,{defaultValue:w.current,onChange:Y}),t("span",{children:"\u79D2"})]}),onVisibleChange:()=>o.$dispatch("setCountdownTime",String(w.current)),overlayClassName:"home-countdown-popover",placement:"bottom",title:"",trigger:"click",children:a("div",{className:"home-countdown",children:[t(he,{className:"home-countdown-main",value:q,format:"m:ss",onFinish:Z}),t("div",{className:`home-countdown-placeholder ${T.current?"time-run":""}`,children:G})]})})}),t(u,{flex:"50px",children:t(O,{className:"home-reload-btn",onClick:$,type:"primary",icon:t(ie,{})})})]}),t("div",{className:"home-type-result-container",children:p&&a(b,{className:"home-type-result",children:[t(u,{span:24,children:a("div",{className:"result-wpm",children:[h.current.wpm,"WPM"]})}),t(u,{span:12,children:t("div",{className:"result-title",children:"\u6B63\u786E"})}),t(u,{span:12,children:t("div",{className:"result-numbers correct",children:h.current.correct})}),t(u,{span:12,children:t("div",{className:"result-title",children:"\u9519\u8BEF"})}),t(u,{span:12,children:t("div",{className:"result-numbers wrong",children:h.current.wrong})}),t(u,{span:12,children:t("div",{className:"result-title",children:"\u6309\u952E\u603B\u6570"})}),t(u,{span:12,children:t("div",{className:"result-numbers",children:W.current})}),t(u,{span:24,children:t(z,{ghost:!0,className:"type-resule-collapse",children:t(fe,{header:"\u5C55\u5F00\u6B64\u6B21\u8F93\u5165",children:h.current.inputWordArr.map((e,n)=>a(ue,{color:e.isCorrect?"success":"error",children:[t("div",{children:e.label}),t("div",{children:e.input})]},n))},"1")})})]})})]})})})};var Ne=de(me);export{Ne as default};
