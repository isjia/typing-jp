import{r as u,e as h,j as o,m as p,R as Q,C as j}from"./vendor.d9062a6e.js";import{s as X}from"./index.028fc849.js";import{w as R}from"./wordTool.5f109ba6.js";import{R as P,T as Y}from"./ReloadBtn.f740f3d4.js";const N=32,Z=8,x=i=>Array.from(i.children),V=i=>{const S=u.exports.useRef(null),d=u.exports.useRef(null),K=u.exports.useRef(null),E=u.exports.useRef(R.getWords(i.$state.root.wordsMode,i.$state.root.customerWords)),C=u.exports.useRef([0,0]),l=u.exports.useRef({wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}}),[O,y]=u.exports.useState(!1),[D,T]=u.exports.useState(!1),[z,v]=u.exports.useState(!1),[b,A]=u.exports.useState(!1),[m,$]=u.exports.useState(""),[f,W]=u.exports.useState([]),[I,M]=u.exports.useState({top:0,left:0}),[B,G]=u.exports.useState(30),k=()=>{const r=C.current,e=d.current.getBoundingClientRect(),t=x(d.current)[r[0]];if(!t)return;const s=Array.from(t.getElementsByClassName("letter"));if(s.length<=r[1]){const n=s[r[1]-1].getBoundingClientRect();M({top:n.top-e.top+2,left:n.left-e.left+n.width})}else{const n=s[r[1]].getBoundingClientRect();M({top:n.top-e.top+2,left:n.left-e.left})}},U=u.exports.useCallback((r,e)=>{const t=C.current,s=m===""||m.charAt(m.length-1)===" ";let n;if(r===N)s?n=t:n=[t[0]+1,0];else{if(t[1]>=f[t[0]].letterArr.length){const c=x(d.current)[t[0]],a=document.createElement("code");a.className="letter wrong extra-letter",a.innerText=e,c.appendChild(a)}n=[t[0],t[1]+1]}C.current=n,k(),W(c=>{const a=c[t[0]].letterArr[t[1]];if(a&&r!==N&&(console.log(e===a.letter,a),a.isCorrect=e===a.letter,c[t[0]].letterArr[t[1]]=a),r===N&&!s)if(c[t[0]].letterArr.some(g=>g.isCorrect===null))c[t[0]].isSkip=!0,c[t[0]].isCorrect=!1;else{const L=x(d.current)[t[0]].getElementsByClassName("extra-letter");!L||L.length===0?c[t[0]].isCorrect=c[t[0]].letterArr.every(J=>J.isCorrect):c[t[0]].isCorrect=!1}return(n[0]>c.length-1||t[0]===c.length-1&&t[1]===c[t[0]].letterArr.length-1)&&(c[t[0]].isCorrect=c[t[0]].letterArr.every(g=>g.isCorrect),l.current.right=c.filter(g=>g.isCorrect).length,l.current.wrong=c.length-l.current.right,l.current.acc=Math.round(l.current.right/(l.current.right+l.current.wrong)*100),l.current.time.secs=Math.round((Date.now()-l.current.time.begin)/1e3),l.current.wpm=(l.current.right/(l.current.time.secs/60)).toFixed(2),y(!1),v(!0),setTimeout(()=>{A(!0)},150)),c}),$(c=>r===N&&(c===""||c.charAt(c.length-1)===" ")?c:c+e)},[m,f]),q=u.exports.useCallback(()=>{const r=m.charAt(m.length-1);if(r==="")return;const e=C.current;let t;if(r===" ")if(f[e[0]-1].isCorrect)t=e;else if(f[e[0]-1].isSkip){const s=f[e[0]-1].letterArr.findIndex(n=>n.isCorrect===null);t=[e[0]-1,s]}else{const n=x(d.current)[e[0]-1].getElementsByClassName("letter");t=[e[0]-1,n.length]}else{const s=x(d.current)[e[0]],n=s.getElementsByClassName("extra-letter");n&&n.length>0&&s.removeChild(n[n.length-1]),t=[e[0],e[1]-1]}C.current=t,k(),W(s=>(r===" "?s[e[0]-1].isCorrect===!1&&(s[e[0]-1].isCorrect=null):s[e[0]].letterArr.length>=e[1]&&(s[e[0]].letterArr[e[1]-1].isCorrect=null,s[e[0]].isCorrect=null),s)),$(s=>{let n=!0;return r===" "&&f[e[0]-1].isCorrect&&(n=!1),n?s.substring(0,s.length-1):s})},[m,f]),H=r=>{r.keyCode!==9&&(r.preventDefault(),r.stopPropagation(),r.persist()),!b&&(T(!1),r.key.length===1?(l.current.time.begin===0&&(l.current.time.begin=Date.now()),U(r.keyCode,r.key)):r.keyCode===Z&&q())},w=()=>{y(!0),S.current.focus()},F=u.exports.useCallback(()=>{C.current=[0,0],E.current=R.shuffle(E.current),l.current={wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}};const r=d.current.getElementsByClassName("extra-letter");r.length!==0&&Array.from(r).forEach(e=>{e.parentNode.removeChild(e)}),W(R.jsonCopy(E.current.slice(0,B)).map(e=>Object.assign({},e,{letterArr:Array.from(e.text).map(t=>({letter:t,isCorrect:null})),isCorrect:null,isSkip:!1}))),$(""),v(!1),A(!1),setTimeout(()=>{w(),k()},10)},[B]);return u.exports.useEffect(()=>{E.current=R.getWords(i.$state.root.wordsMode,i.$state.root.customerWords),F()},[i.$state.root.wordsMode,i.$state.root.customerWords,F,B]),h("div",{className:"Monkey",children:[o("div",{className:"word-count-radio",children:h(p.Group,{value:B,size:"small",onChange:r=>{G(r.target.value)},children:[o(p.Button,{tabIndex:-1,value:20,children:"20"}),o(p.Button,{tabIndex:-1,value:30,children:"30"}),o(p.Button,{tabIndex:-1,value:40,children:"40"}),o(p.Button,{tabIndex:-1,value:50,children:"50"})]})}),h(Q,{justify:"center",align:"middle",children:[h(j,{flex:"900px",className:`type-main-box ${z?"fading":""} ${b?"hide":""}`,children:[o("div",{className:`caret ${O?D?"flash":"":"hide"}`,ref:K,style:{transform:`translate3d(${I.left}px,${I.top}px,0)`}}),o("div",{className:"words-box",onClick:w,ref:d,children:f.map((r,e)=>{var t;return h("div",{className:`word ${r.isCorrect?"correct":r.isCorrect===!1?"wrong":""}`,children:[o("div",{className:"label",children:r.label}),(t=r.letterArr)==null?void 0:t.map((s,n)=>o("code",{className:`letter ${s.isCorrect?"correct":s.isCorrect===!1?"wrong":""}`,children:s.letter},`${e}_${n}`))]},e)})}),o("input",{className:"hidden-input",type:"text",ref:S,onKeyDown:H,onBlur:()=>{y(!1)},onFocus:()=>{y(!0),T(!0)}}),o("div",{className:"reload-line",children:o(P,{onClick:F})}),h("div",{className:`tip-line ${D?"":"hide"}`,children:[o("div",{children:"\u70B9\u51FB\u8BCD\u5757\u8FDB\u5165\u8F93\u5165\u72B6\u6001"}),o("div",{children:"\u8F93\u5165\u6B63\u786E\u7684\u62FC\u97F3\u5B57\u6BCD\uFF0C\u7136\u540E\u7A7A\u683C"}),h("div",{children:["\u8F93\u5165\u72B6\u6001\u4E0B",o("code",{children:"Tab"}),"\u540E\u56DE\u8F66\u53EF\u4EE5\u76F4\u63A5\u5237\u65B0"]}),o("div",{children:"\u89C9\u5F97\u6709\u610F\u601D\u53EF\u4EE5\u6253\u8D4F\u4E00\u4E0B(#^.^#)(\u5728\u4E0A\u9762\u2191\u2191)"})]})]}),h(j,{flex:"900px",className:`type-result-box ${b?"show":""}`,children:[o(Y,{desc:"WPM",numStr:l.current.wpm,acc:l.current.acc,secs:l.current.time.secs}),o("div",{className:"reload-line",children:o(P,{onClick:F})})]})]})]})};var se=X(V);export{se as default};
